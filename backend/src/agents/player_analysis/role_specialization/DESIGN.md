# RoleSpecializationAgent Design Document

## Overview
RoleSpecializationAgent analyzes a player's specialization and performance in a specific role (TOP/JUNGLE/MIDDLE/BOTTOM/SUPPORT), providing insights into champion pool, lane proficiency, and role mastery.

## Purpose
- **Role mastery evaluation**: Quantify expertise in a specific position
- **Champion pool analysis**: Identify core champions and coverage gaps
- **Lane phase proficiency**: Assess early game performance
- **Role-specific metrics**: Analyze position-relevant statistics
- **Gap identification**: Find missing meta champions for the role

## Input Data
- **Source**: Player-pack files (pack_*.json) from all available patches
- **Required fields**:
  - `by_cr[]`: Champion-role statistics filtered by specific role
  - `metadata.patch`: Patch version
- **Role filter**: Extract all data for a specific role (TOP/JUNGLE/MID/ADC/SUP)

## Analysis Components

### 1. Overall Role Performance
- **Total games played**: In this role across all patches
- **Overall win rate**: With Wilson 95% CI
- **Role play rate**: % of total games in this role
- **Version coverage**: Number of patches where role was played
- **Role mastery score**: Overall proficiency grade (S/A/B/C/D/F)

### 2. Champion Pool Analysis

#### Champion Pool Breadth
- **Total champions played**: Unique champions in this role
- **Core champions**: Champions with 30+ games (deep mastery)
- **Secondary champions**: Champions with 10-29 games (proficiency)
- **Experimental champions**: Champions with <10 games (learning)

#### Champion Pool Depth
For each core champion:
- Games played and win rate
- Performance compared to overall role average
- Carry potential (KDA analysis)
- Patch coverage (version consistency)

### 3. Position-Specific Performance

#### Early Game (Lane Phase)
- CS efficiency (if available)
- Kill/Death ratio in first 15 minutes
- Early game win rate trend

#### Mid Game (Team Fight Phase)
- Kill participation rate
- Objective control contribution
- Team fight effectiveness

#### Late Game (Macro Phase)
- Late game win rate
- Damage/Tank effectiveness based on role
- Clutch performance in close games

### 4. Meta Alignment Analysis
- **Current meta champions**: Identify strong picks in current patch
- **Player's champion pool coverage**: Which meta champions player has mastered
- **Gap analysis**: Missing high-priority meta champions
- **Adaptation recommendations**: Which champions to learn for better meta coverage

### 5. Version Adaptation
- Performance across different patches
- Consistency in the role over time
- Impact of meta shifts on role performance

## Output Structure

### Quantitative Analysis (JSON)
```json
{
  "role": "MIDDLE",
  "summary": {
    "total_games": 245,
    "overall_winrate": 0.567,
    "ci_lower": 0.504,
    "ci_upper": 0.628,
    "role_play_rate": 0.738,
    "version_coverage": 9,
    "role_mastery_score": "A",
    "proficiency_score": 82
  },
  "champion_pool": {
    "breadth": {
      "total_champions": 12,
      "core_champions": 3,
      "secondary_champions": 4,
      "experimental_champions": 5
    },
    "depth": {
      "core": [...],
      "secondary": [...],
      "experimental": [...]
    },
    "diversity_score": 0.68
  },
  "meta_analysis": {
    "meta_champions_played": [...],
    "meta_champions_missing": [...],
    "meta_coverage": 0.62
  }
}
```

### Narrative Report (Markdown)
- **2500-3500 word detailed report** generated by Sonnet 4.5
- Sections:
  1. Role Mastery Overview (400-500 words)
  2. Champion Pool Analysis (700-900 words)
  3. Position-Specific Performance (600-800 words)
  4. Meta Alignment and Gaps (500-700 words)
  5. Strengths and Improvement Areas (400-600 words)
  6. Champion Pool Expansion Recommendations (300-400 words)

## Role Mastery Score Calculation

### Scoring Components
1. **Volume Score** (0-25 points):
   - 0-30 games: 10 points
   - 31-75 games: 18 points
   - 76+ games: 25 points

2. **Performance Score** (0-40 points):
   - Win rate vs 50% baseline
   - Scaled by CI width (confidence)

3. **Champion Pool Score** (0-20 points):
   - Breadth: Number of champions (5 points)
   - Depth: Core champions mastery (10 points)
   - Diversity: Champion type variety (5 points)

4. **Consistency Score** (0-15 points):
   - CI width (performance stability)
   - Patch-to-patch variance

### Grade Mapping
- **S**: 90-100 points (Elite role specialist)
- **A**: 80-89 points (Strong role proficiency)
- **B**: 70-79 points (Solid role player)
- **C**: 60-69 points (Competent)
- **D**: 50-59 points (Developing)
- **F**: <50 points (Beginner)

## Technical Implementation

### Files
1. **tools.py**: Data extraction and analysis functions
   - `extract_role_data()`: Filter packs for specific role
   - `analyze_champion_pool()`: Champion pool breadth/depth analysis
   - `analyze_role_performance()`: Overall role performance metrics
   - `analyze_meta_alignment()`: Meta coverage and gaps
   - `calculate_role_mastery_score()`: Overall role proficiency scoring
   - `format_analysis_for_prompt()`: Prepare data for LLM

2. **prompts.py**: LLM prompt engineering
   - `SYSTEM_PROMPT`: Guide Sonnet to generate 2500-3500 word report
   - `build_narrative_prompt()`: Construct user prompt with analysis data

3. **agent.py**: Main agent orchestration
   - `RoleSpecializationAgent.run()`: Execute full analysis pipeline

4. **__init__.py**: Module exports

### Dependencies
- Reuse `src/core/statistical_utils.py` for Wilson CI calculations
- Standard libraries: json, pathlib, typing, defaultdict

## Usage Example

```python
from src.agents.player_analysis import RoleSpecializationAgent

agent = RoleSpecializationAgent(model="sonnet")

analysis, report = agent.run(
    role="MIDDLE",  # or TOP/JUNGLE/BOTTOM/SUPPORT
    packs_dir="test_agents/player_coach/packs",
    output_dir="output/role_specialization"
)

print(f"Role Mastery Score: {analysis['summary']['role_mastery_score']}")
print(f"Champion Pool: {analysis['champion_pool']['breadth']['total_champions']} champions")
print(f"\n{report}")
```

## Quality Standards
- Minimum 20 games required for meaningful analysis
- Statistical significance testing for champion comparisons
- Evidence-based meta gap identification
- Comprehensive 2500-3500 word narrative report
- JSON output for programmatic access

## Future Enhancements
- Matchup-specific analysis (performance vs different enemy roles)
- Synergy analysis (best teammates for this role)
- Comparative analysis (vs same-role players at higher ranks)
- Optimal champion rotation recommendations
- Build path and rune analysis for the role
